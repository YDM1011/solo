<div class="wrapper wrapper-content animated fadeInUp">
  <div class="ibox">
    <div class="ibox-content">
      <div class="row">
        <div class="col-lg-12">
          <div class="m-b-md">
            <h2>Замовлення </h2>
          </div>

        </div>
      </div>
      <div class="row">
        <div class="col-lg-12">
          <dl class="row mb-0">
            <div class="col-sm-4 text-sm-right"><dt>Кад замовлення:</dt></div>
            <div class="col-sm-8 text-sm-left">
              <dd class="mb-1" *ngIf="order; else preload">{{order.id}}</dd>
            </div>
          </dl>
          <dl class="row mb-0">
            <div class="col-sm-4 text-sm-right"><dt>Номер замовлення:</dt></div>
            <div class="col-sm-8 text-sm-left">
              <dd class="mb-1" *ngIf="order; else preload">{{order.orderNumber}}</dd>
            </div>
          </dl>
          <dl class="row mb-0">
            <div class="col-sm-4 text-sm-right"><dt>Замовник:</dt> </div>
            <div class="col-sm-8 text-sm-left">
              <dd class="mb-1"  *ngIf="order; else preload">
                <a target="_blank" [href]="apiDomain+'/user/'+order.client._id" class="flex">
                  <div class="avatar">
                    <img [src]="apiDomain+order.client.photo.picCrop" alt="avatar">
                  </div>
                  <div class="client-info">
                    <div>{{order.client.firstName}} {{order.client.lastName}}</div>
                    <div>{{order.mobile}}</div>
                    <div>{{order.client.data | date: "MM.yyyy HH:mm"}}</div>
                    <div>Всього замолень {{allInAny}} (у цьому закладі {{allInThis}})</div>
                  </div>
                </a>

              </dd>
            </div>
          </dl>
          <dl class="row mb-0">
            <div class="col-sm-4 text-sm-right"><dt>Тип оплати:</dt> </div>
            <div class="col-sm-8 text-sm-left"><dd class="mb-1"  *ngIf="order; else preload">{{order.paymentType | payment}}
              <ng-container *ngIf="order.paymentType == 'fiat' && order.paymentDetail">{{order.paymentDetail.fiatVal}} грн</ng-container>
            </dd> </div>
          </dl>
          <dl class="row mb-0">
            <div class="col-sm-4 text-sm-right"><dt>Адреса:</dt> </div>
            <div class="col-sm-8 text-sm-left"><dd class="mb-1"  *ngIf="order; else preload">{{order.address}}</dd> </div>
          </dl>
          <dl class="row mb-0">
            <div class="col-sm-4 text-sm-right"><dt>Додатковий телефон:</dt> </div>
            <div class="col-sm-8 text-sm-left"><dd class="mb-1"  *ngIf="order; else preload">{{order.anyMobile}}</dd> </div>
          </dl>
          <dl class="row mb-0">
            <div class="col-sm-4 text-sm-right"><dt>Вартість страв:</dt> </div>
            <div class="col-sm-8 text-sm-left flex price">
              <dd class="mb-1 "  *ngIf="order; else preload">{{order.productPrice}} грн</dd>
              <ng-container *ngIf="isCanEdit">
                <label><input type="number" [(ngModel)]="totalPrice" name="totalPrice"> грн</label>
                <button class="btn btn-xs btn-primary">Зберегти</button>
              </ng-container>
            </div>
          </dl>
          <ng-container *ngIf="order; else preload">
            <dl class="row mb-0" *ngIf="order && order.boxPrice">
              <div class="col-sm-4 text-sm-right"><dt>Вартість упаковки:</dt> </div>
              <div class="col-sm-8 text-sm-left flex price">
                <dd class="mb-1 " *ngIf="order; else preload">{{order.boxPrice}} грн</dd>
                <ng-container *ngIf="isCanEdit">
                  <label><input type="number" [(ngModel)]="boxesPrice" name="boxesPrice"> грн</label>
                  <button class="btn btn-xs btn-primary">Зберегти</button>
                </ng-container>
              </div>
            </dl>
            <dl class="row mb-0" *ngIf="order && order.deliveryPrice">
              <div class="col-sm-4 text-sm-right"><dt>Вартість доставки:</dt> </div>
              <div class="col-sm-8 text-sm-left flex price">
                <dd class="mb-1 "  *ngIf="order; else preload">{{order.deliveryPrice}} грн</dd>
                <ng-container *ngIf="isCanEdit">
                  <label><input type="number" [(ngModel)]="deliveryPrice" name="deliveryPrice"> грн</label>
                  <button class="btn btn-xs btn-primary">Зберегти</button>
                </ng-container>
              </div>
            </dl>
          </ng-container>

          <dl class="row mb-0">
            <div class="col-sm-4 text-sm-right"><dt>Загальна вартість:</dt> </div>
            <div class="col-sm-8 text-sm-left">
              <dd class="mb-1"  *ngIf="order; else preload">{{order.deliveryPrice + order.boxPrice + order.productPrice}} грн</dd>
            </div>
          </dl>
          <dl class="row mb-0">
            <div class="col-sm-4 text-sm-right"><dt>Обов'язково зателефонувати?</dt> </div>
            <div class="col-sm-8 text-sm-left">
              <b class="mb-1" *ngIf="order; else preload">{{order.isCall}}</b>
            </div>
          </dl>
          <dl class="row mb-0">
            <div class="col-sm-4 text-sm-right"><dt>Статуст:</dt> </div>
            <div class="col-sm-8 text-sm-left">
              <dd class="mb-1" *ngIf="order; else preload">
                <span class="label label-primary">{{order.status}}</span>
              </dd>
            </div>
          </dl>
          <dl class="row mb-0">
            <div class="col-sm-4 text-sm-right"><dt>Коментування:</dt> </div>
            <div class="col-sm-8 text-sm-left">
              <dd class="mb-1"  *ngIf="order; else preload">
                <div *ngFor="let com of order.orderCommentData">
                  <div *ngIf="com.text"><i>{{com.entity}}: </i><span>{{com.text}}</span></div>
                </div>
                <ng-container *ngIf="isCanEdit">
                  <div><textarea name="comment" [(ngModel)]="comment"></textarea></div>
                  <div><button class="btn btn-xs btn-primary">Коментувати</button></div>
                </ng-container>

              </dd>
            </div>
          </dl>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-lg-12">
    <div class="ibox">
      <div class="ibox-content">

        <table class="footable table table-stripped toggle-arrow-tiny footable-loaded tablet breakpoint" data-page-size="15">
          <thead>
          <tr>

            <!--<th class="footable-visible footable-first-column">Статус</th>-->
            <th class="footable-visible">Страва</th>
            <th class="footable-visible">Компоненти</th>
            <th class="footable-visible">Порція</th>
            <th class="footable-visible">Кількість</th>
            <th class="footable-visible">Ціна</th>
            <th class="footable-visible">Упаковка</th>
            <th class="footable-visible">Коментар</th>

          </tr>
          </thead>
          <tbody>
          <ng-container *ngIf="order; else preload">
            <ng-container *ngFor="let prod of order.products">
              <ng-container *ngIf="prod">
                <tr class="footable-even sible footable-first-column">
                  <!--<td class="footable-visible"><span class="footable-toggle"></span>-->
                    <!--<input type="checkbox" [(ngModel)]="prod.status" name="prod-{{prod._id}}">-->
                  <!--</td>-->
                  <td class="footable-visible">
                    {{prod.dishData.name}}
                  </td>
                  <td class="footable-visible">
                    <ng-container *ngFor="let comp of prod.complementData">
                      <ng-container *ngIf="comp">
                        <ng-container *ngIf="comp.id">
                          <span> {{comp.count}} {{comp.id.name}} </span>
                        </ng-container>
                      </ng-container>
                    </ng-container>
                  </td>

                  <td class="footable-visible">
                    {{prod.portItemData.name}} {{prod.portItemData.price}} грн
                  </td>
                  <td class="footable-visible">
                    {{prod.count}} шт.
                  </td>
                  <td class="footable-visible">
                    {{prod.totalPrice}} грн
                  </td>
                  <td class="footable-visible">
                    <ng-container *ngIf="prod.boxData">{{prod.boxData.price || 0}} грн</ng-container>
                    <ng-container *ngIf="!prod.boxData">-</ng-container>
                  </td>
                  <td class="footable-visible">
                    <ng-container *ngFor="let com of prod.orderCommentData">
                      <ng-container *ngIf="com">
                        <ng-container *ngIf="com.text">
                          <p> {{com.text}} </p>
                        </ng-container>
                      </ng-container>
                    </ng-container>
                  </td>
                </tr>
              </ng-container>
            </ng-container>
          </ng-container>
          </tbody>
          <tfoot>

          </tfoot>
        </table>
        <div class="btn-wrap" *ngIf="order; else preload">
          <ng-container *ngIf="order.status==1">
            <ng-container *ngIf="order.paymentType != 'fiat'">
              <ng-container *ngTemplateOutlet="whait"></ng-container>
            </ng-container>
            <ng-container *ngIf="order.paymentType == 'fiat'">
              <ng-container *ngTemplateOutlet="confirm"></ng-container>
            </ng-container>
            <ng-container *ngTemplateOutlet="change"></ng-container>
            <ng-container *ngTemplateOutlet="delet"></ng-container>
          </ng-container>
          <ng-container *ngIf="order.status==2">
            <ng-container *ngTemplateOutlet="done"></ng-container>
            <ng-container *ngTemplateOutlet="delet"></ng-container>
          </ng-container>
          <ng-container *ngIf="order.status==3">
            <ng-container *ngTemplateOutlet="delet"></ng-container>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #preload>
  load...
</ng-template>

<ng-template #confirm>
  <button class="btn btn-xs btn-success" (click)="confirmOrder()" >Підтвердити</button>
</ng-template>
<ng-template #change>
  <button class="btn btn-xs btn-warning" (click)="changeOrder()">Змінене оператором</button>
</ng-template>
<ng-template #delet>
  <button class="btn btn-xs btn-danger" (click)="deletOrder()">Відмінити</button>
</ng-template>
<ng-template #whait>
  <button class="btn btn-xs btn-info" (click)="whaitOrder()">Очікувати оплату</button>
</ng-template>
<ng-template #done>
  <button class="btn btn-xs btn-primary" (click)="doneOrder()">Виконано</button>
</ng-template>

<router-outlet></router-outlet>
